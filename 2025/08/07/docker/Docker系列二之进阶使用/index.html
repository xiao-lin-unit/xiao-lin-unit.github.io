<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>小琳的星空 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/imgs/shortcut-icon.ico?time=789" type="image/x-icon">
  <link rel="stylesheet" href="/css/public.css?time=789" />
  <link rel="stylesheet" href="/css/layout.css?time=789" />
  <link rel="stylesheet" href="/css/iconfont.css?time=789" />
  <link rel="stylesheet" href="/css/APlayer.min.css?time=789" />
  <script src="/js/APlayer.min.js?time=789"></script>
  <script src="/js/jquery.min.js?time=789"></script>
  <script src="/js/jquery.pjax.min.js?time=789"></script>

  <script src="/js/Valine.min.js?time=789"></script>
<!--  <script src='https://unpkg.com/valine/dist/Valine.min.js'></script>-->
  <script>
    document.title = `小琳的星空`
  </script>
<meta name="generator" content="Hexo 6.3.0"></head>

<style>
  .load {
    width: 100%;
    height: 100vh;
    background-color: rgb(37, 35, 40);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 9999;
  }
  .load-circle {
    width: 80px;
    height: 80px;
    border: 8px solid orange;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rotate 1s linear infinite;
    filter: drop-shadow(0 0 3px orange);
  }
  .load-circle-inner {
    width: 40px;
    height: 40px;
    border: 8px solid orange;
    border-top-color: transparent;
    border-radius: 50%;
    animation: rotate-reverse .5s linear infinite;
  }
  .load-text {
    margin-top: 20px;
    font-size: 24px;
    color: orange;
    display: flex;
  }
  .load-text span {
    margin: 0 5px;
    text-shadow: 5px 5px 5px orange;
    animation: move 1s linear infinite;
  }
  .load-text span:nth-child(1) {
    animation-delay: -0.6s;
  }
  .load-text span:nth-child(2) {
    animation-delay: -0.5s;
  }
  .load-text span:nth-child(3) {
    animation-delay: -0.4s;
  }
  .load-text span:nth-child(4) {
    animation-delay: -0.3s;
  }
  .load-text span:nth-child(5) {
    animation-delay: -0.2s;
  }
  .load-text span:nth-child(6) {
    animation-delay: -0.1s;
  }
  @keyframes rotate {
    0% { transform: rotate(0); }
    100% { transform: rotate(360deg); }
  }
  @keyframes rotate-reverse {
    0% { transform: rotate(0); }
    100% { transform: rotate(-360deg); }
  }
  @keyframes move {
    0% { transform: translateY(0%) rotate(0) scale(1); }
    20% { transform: translateY(20%) rotate(10deg) scale(1.2); }
    80% { transform: translateY(-10%) rotate(-20deg) scale(.8);}
    100% { transform: translateY(0) rotate(0) scale(1); }
  }

  .progress {
    position: fixed;
    left: 0; top: 0;
    width: 0;
    height: 3px;
    background-color: green;
    transition: all cubic-bezier(0.215, 0.610, 0.355, 1) .1s;
    z-index: 9999;
  }

  .to-up {
    animation: toUp .5s 1;
  }
  .gray {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100vh;
    z-index: 9999;
    display: none;
    pointer-events: none;
    background-color: #000;
    mix-blend-mode: color;
  }
  @keyframes toUp {
    from { transform: translateY(15px); opacity: 0; }
    to { transform: translateY(0) ; opacity: 1; }
  }
</style>
<body>
  <div id="load" class="load">
    <div class="load-circle">
      <div class="load-circle-inner"></div>
    </div>
    <p class="load-text">
      <span>L</span>
      <span>O</span>
      <span>A</span>
      <span>D</span>
      <span>I</span>
      <span>N</span>
      <span>G</span>
    </p>
  </div>
  <div id="container" class="container w-100 vh-100" style="display: none;">
    <header class="header">
  <div class="header-wrapper">
    <div class="header-left">
      <div class="header-search">
        <input id="search-input" type="text" class="header-search--input" placeholder="请输入要检索的文章标题" />
        <span id="search-btn" class="header-search--icon"><i class="iconfont icon-sousuo"></i></span>
      </div>
      <div id="search-layer" class="header-search--layer hidden">
        <p class="title">
          <span>以下是搜索内容：</span>
          <span id="close-layer-btn">关闭</span>
        </p>
        <ul>
        </ul>
      </div>
    </div>
    <div class="header-right">
      <ul class="header-menu">
        <li>
          <a href="/?time=' + new Date().getMilliseconds()">
<!--          <a href="http://example.com/">-->
            <i class="header-menu--icon iconfont icon-shouye"></i>
            <span class="header-menu--span">首页</span>
          </a>
        </li>
        <li>
          <a href="/log?time=' + new Date().getMilliseconds()">
<!--          <a href="http://example.com/log?time=786">-->
            <i class="header-menu--icon iconfont icon-rizhi"></i>
            <span class="header-menu--span">日志</span>
          </a>
        </li>
        <li>
          <a href="/link?time=' + new Date().getMilliseconds()">
<!--          <a href="http://example.com/link?time=786">-->
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
            <span class="header-menu--span">友情链接</span>
          </a>
        </li>
        <li>
          <a href="/about?time=' + new Date().getMilliseconds()">
<!--          <a href="http://example.com/about?time=787">-->
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
            <span class="header-menu--span">关于我</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<script>
  const ipt = document.querySelector('#search-input')
  const btn = document.querySelector('#search-btn')
  const layer = document.querySelector('#search-layer')
  const posts = JSON.parse(`[{"title":"Docker系列(一)---安装和基本使用","cover":"/imgs/cover/default-cover.jpeg?time=746?time=747?time=750?time=752?time=759?time=759","path":"2025/08/05/docker/Docker系列一之安装和基本使用/"},{"title":"Docker系列(三)---项目部署","cover":"/imgs/cover/default-cover.webp?time=746?time=747?time=750?time=752?time=759","path":"2025/08/11/docker/Docker系列三之项目部署/"},{"title":"Docker系列(二)---进阶使用","cover":"/imgs/cover/default-cover.webp?time=746?time=747?time=750?time=752?time=759?time=759","path":"2025/08/07/docker/Docker系列二之进阶使用/"},{"title":"MySQL系列(三)---索引","cover":"/imgs/cover/default-cover.webp?time=739?time=744?time=747?time=753?time=760","path":"2024/04/29/mysql/MySQL系列三之索引/"},{"title":"MySQL系列(一)---安装","cover":"/imgs/cover/default-cover.webp?time=731?time=733?time=737?time=751?time=753?time=761","path":"2023/11/27/mysql/MySQL系列一之安装/"},{"title":"Promise","cover":"/imgs/cover/default-cover.jpeg?time=731?time=735?time=737?time=751?time=754?time=761","path":"2023/11/24/js/Promise/"},{"title":"MySQL系列(二)---SQL","cover":"/imgs/cover/default-cover.jpeg?time=739?time=742?time=747?time=753?time=760","path":"2024/02/26/mysql/MySQL系列二之SQL/"},{"title":"博客搭建","cover":"/imgs/cover/default-cover.webp?time=731?time=735?time=737?time=751?time=754?time=761?time=762","path":"2023/11/22/other/博客搭建/"},{"title":"项目对接招商银行CBS","cover":"/imgs/cover/default-cover.webp?time=739?time=742?time=747?time=754?time=762","path":"2024/02/21/other/项目对接招商银行CBS/"},{"title":"Redis系列(一)---安装","cover":"/imgs/cover/default-cover.webp?time=731?time=733?time=738?time=751?time=755?time=763","path":"2023/12/12/redis/Redis系列一之安装/"},{"title":"项目对接海康SDK","cover":"/imgs/cover/default-cover.webp?time=727?time=739?time=742?time=750?time=754?time=763","path":"2024/02/21/other/项目对接海康SDK/"},{"title":"SpringCloud系列(一)---项目创建","cover":"/imgs/cover/default-cover.webp?time=731?time=733?time=737?time=751?time=755?time=764","path":"2023/11/25/springcloud/SpringCloud系列一之基础服务/"},{"title":"SpringCloud系列(七)---认证和授权","cover":"/imgs/cover/default-cover.jpeg?time=727?time=739?time=742?time=750?time=755?time=764","path":"2024/02/03/springcloud/SpringCloud系列七之认证和授权/"},{"title":"SpringCloud系列(九)---阶段总结","cover":"/imgs/cover/default-cover.jpeg?time=739?time=744?time=747?time=755?time=764","path":"2024/05/11/springcloud/SpringCloud系列九之阶段总结/"},{"title":"SpringCloud系列(三)---服务熔断与降级","cover":"/imgs/cover/default-cover.webp?time=731?time=733?time=738?time=751?time=755?time=764?time=765?time=765","path":"2023/12/02/springcloud/SpringCloud系列三之服务熔断与降级/"},{"title":"SpringCloud系列(二)---注册中心和配置中心","cover":"/imgs/cover/default-cover.jpeg?time=731?time=733?time=737?time=751?time=755?time=764?time=766?time=766","path":"2023/11/30/springcloud/SpringCloud系列二之注册中心/"},{"title":"SpringCloud系列(五)---Redis使用","cover":"/imgs/cover/default-cover.jpeg?time=727?time=733?time=738?time=750?time=755?time=763?time=764","path":"2023/12/14/springcloud/SpringCloud系列五之Redis使用/"},{"title":"SpringCloud系列(八)---服务划分","cover":"/imgs/cover/default-cover.webp?time=727?time=739?time=742?time=750?time=755?time=767","path":"2024/02/19/springcloud/SpringCloud系列八之服务划分/"},{"title":"SpringCloud系列(四)---网关","cover":"/imgs/cover/default-cover.jpeg?time=731?time=733?time=738?time=751?time=755?time=764?time=767","path":"2023/12/10/springcloud/SpringCloud系列四之网关/"},{"title":"SpringCloud系列(六)---分布式主键","cover":"/imgs/cover/default-cover.webp?time=731?time=733?time=738?time=751?time=755?time=764?time=768","path":"2023/12/11/springcloud/SpringCloud系列六之分布式主键/"},{"title":"NPM和PNPM的安装及配置","cover":"/imgs/cover/default-cover.webp?time=727?time=733?time=738?time=750?time=756?time=768?time=769?time=769","path":"2023/12/26/node/npm和pnpm安装及配置/"},{"title":"Typescript系列(一)---基础","cover":"/imgs/cover/default-cover.webp?time=727?time=733?time=738?time=750?time=757?time=769","path":"2023/12/26/ts/TypeScript系列一之基础/"},{"title":"Typescript系列(二)---高级","cover":"/imgs/cover/default-cover.jpeg?time=727?time=740?time=741?time=750?time=757?time=769","path":"2024/01/04/ts/TypeScript系列二之高级/"},{"title":"Vue系列(一)---项目创建和配置","cover":"/imgs/cover/default-cover.webp?time=746?time=747?time=749?time=757?time=769?time=770?time=770","path":"2025/06/19/web/Vue系列一之项目创建和配置/"},{"title":"Vue系列(三)---状态管理库","cover":"/imgs/cover/default-cover.webp?time=727?time=739?time=741?time=750?time=757?time=773","path":"2024/01/18/web/Vue系列三之状态管理库/"},{"title":"Vue系列(二)---路由","cover":"/imgs/cover/default-cover.jpeg?time=727?time=740?time=741?time=750?time=757?time=771","path":"2024/01/07/web/Vue系列二之路由/"},{"title":"Zookeeper系列(一)---原理","cover":"/imgs/cover/default-cover.webp?time=739?time=745?time=747?time=758?time=766","path":"2024/11/28/zookeeper/Zookeeper系列一之原理/"},{"title":"Vue系列(四)---请求","cover":"/imgs/cover/default-cover.jpeg?time=727?time=739?time=742?time=750?time=757?time=774","path":"2024/02/01/web/Vue系列四之请求/"},{"title":"Zookeeper系列(二)---安装配置","cover":"/imgs/cover/default-cover.jpeg?time=746?time=747?time=747?time=758?time=766","path":"2025/01/10/zookeeper/Zookeeper系列二之安装配置/"}]`)
  ipt.addEventListener('keyup', e => {
    if (e.key === 'Enter') {
      handleSearch()
    }
  })
  btn.addEventListener('click', () => {
    handleSearch()
  })

  document.querySelector('#close-layer-btn').addEventListener('click', () => {
    layer.classList.toggle('hidden')
  })

  function handleSearch() {
    if (ipt.value.trim() === '') {
      return
    }
    let html = ''
    const targetPosts = posts.filter(post => post.title.includes(ipt.value))
    targetPosts.forEach(post => {
      html += `
        <li>
          <div>
            <a href="/${post.path}${'?time=' + new Date().getMilliseconds()}">${post.title.replace(new RegExp(ipt.value), `<span>${ipt.value}</span>`)}</a>
          </div>
          <img src="${post.cover || '/imgs/default-cover.webp'}${'?time=' + new Date().getMilliseconds()}" />
        </li>
      `
    })
    if (html.trim () === '') {
      html += '<p class="empty">没有搜索到内容</p>'
    }
    layer.querySelector('ul').innerHTML = html
    layer.classList.remove('hidden')
  }
</script> 
    <section id="main" class="main">
      <div class="main-left-wrapper">
<div class="main-left">
  <div class="main-left--block">
    <div class="main-left--info">
      <img src="/imgs/avatar.jpg?time=787" class="main-left--avatar" alt />
      <div class="main-left--intro">
        <p class="main-left--name">小琳</p>
        <div class="main-left--tags">
          
            <span class="main-left--tag">中二</span>
          
            <span class="main-left--tag">乐天派</span>
          
            <span class="main-left--tag">悲观主义</span>
          
        </div>
      </div>
    </div>
  
    <div>
      <div class="main-left--motto">
        <p>跳出圈子你会发现</p>
        <p>其实你一无是处</p>
      </div>
      <div class="main-left--github">
        <span class="line"></span>
        
          <a target="_blank" rel="noopener" href="https://github.com/?time=787" title="github">
            <i class="logo xiao-lin-blog xiao-lin-blog-github"></i>
          </a>
        
          <a target="_blank" rel="noopener" href="https://gitee.com/xiao-lin?time=787" title="码云">
            <i class="logo xiao-lin-blog xiao-lin-blog-gitee"></i>
          </a>
        
          <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43728193?type=blog?time=787" title="CSDN">
            <i class="logo xiao-lin-blog xiao-lin-blog-csdn"></i>
          </a>
        
          <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiao-lin-unit/?time=787" title="博客园">
            <i class="logo xiao-lin-blog xiao-lin-blog-cnblogs"></i>
          </a>
        
        <span class="line"></span>
      </div>
      <div class="main-left--statics">
        <a href="/categories?time=787">
          <div>
            <span>10</span>
            <span>分类</span>
          </div>
        </a>
        <a href="/tags?time=787">
          <div>
            <span>27</span>
            <span>标签</span>
          </div>
        </a>
        <a href="/archives?time=787">
          <div>
            <span>10 </span>
            <span>归档</span>
          </div>
        </a>
      </div>
    </div>
  </div>

  <div class="main-left--block">
    <ul class="main-left--menu">
      
        <li>
          <a href="/?time=787">
            <span class="header-menu--span">小站首页</span>
            <i class="header-menu--icon iconfont icon-shouye"></i>
          </a>
        </li>
      
        <li>
          <a href="/log?time=787">
            <span class="header-menu--span">个人日志</span>
            <i class="header-menu--icon iconfont icon-rizhi"></i>
          </a>
        </li>
      
        <li>
          <a href="/link?time=787">
            <span class="header-menu--span">友情链接</span>
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
          </a>
        </li>
      
        <li>
          <a href="/about?time=787">
            <span class="header-menu--span">关于自己</span>
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
          </a>
        </li>
      
        <li>
          <a href="/tags?time=787">
            <span class="header-menu--span">标签</span>
            <i class="header-menu--icon xiao-lin-blog xiao-lin-blog-tags-rectangle"></i>
          </a>
        </li>
      
        <li>
          <a href="/categories?time=787">
            <span class="header-menu--span">分类</span>
            <i class="header-menu--icon xiao-lin-blog xiao-lin-blog-categories"></i>
          </a>
        </li>
      
        <li>
          <a href="/tools?time=787">
            <span class="header-menu--span">我的工具</span>
            <i class="header-menu--icon iconfont icon-gongju"></i>
          </a>
        </li>
      
    </ul>
  </div>

  <div class="main-left--block">
    <div class="main-left--site">
      <h5 class="main-left--title">
        <span>站点信息</span>
        <i class="iconfont icon-zhandian"></i>
      </h5>
      <p class="main-left--subtitle">
        <span>文章数目：</span>
        <span>29 篇</span>
      </p>
      <p class="main-left--subtitle">
        <span>最近动态：</span>
        <span>今天</span>
      </p>
      <p class="main-left--subtitle">
        <span>上线时间：</span>
        <span>629天</span>
      </p>
      <p class="main-left--subtitle">
        <span>当前版本：</span>
        <span>v1.0.2</span>
      </p>
    </div>
  </div>
</div></div>
      <div id="main-container" class="main-container">


  

<link rel="stylesheet" href="/css/partial/article.css?time=607" />

<div class="article-container">
  <div class="article">
    <h1 class="article-title">Docker系列(二)---进阶使用</h1>
    <div class="article-info">
      <div class="article-info--item">
        <div class="article-info--info">
          
          <div class="article-info--categories">
            <span class="xiao-lin-blog xiao-lin-blog-categories">分类：</span>
            <a class="category-link" href="/categories/Docker/">Docker</a>
          </div>
          
          
          <div class="article-info--tags">
            <span class="xiao-lin-blog xiao-lin-blog-tags-fill">标签：</span>
            <a class="tag-link" href="/tags/DevOps/" rel="tag">DevOps</a><a class="tag-link" href="/tags/Docker/" rel="tag">Docker</a>
          </div>
          
          <p class="article-info--date"><i class="xiao-lin-blog xiao-lin-blog-date-time">日期：2025-08-07 21:07:53</i></p>
        </div>
<!--        <img src="/imgs/cover/default-cover.webp" alt="" class="article-cover">-->
        <img src="/imgs/cover/default-cover.webp" alt="" class="article-cover">
      </div>
    </div>
    <article class="article-content markdown-body">
      <h3 id="数据卷"><a class="markdownIt-Anchor" href="#数据卷"></a> 数据卷</h3>
<p><code>Volume</code></p>
<h4 id="基本概念"><a class="markdownIt-Anchor" href="#基本概念"></a> 基本概念</h4>
<p>由于容器会将数据进行隔离，所以容器无法访问外部内容，容器内部的内容也不易改变，导致容器实际用途不大。比如，通过<code>nginx</code>镜像创建的容器只能访问到<code>nginx</code>的<code>index.html</code>页面，如果想要将自己的网站部署到该容器中，有两种方式</p>
<ol>
<li>将自己的网站内容添加到容器中</li>
<li>采用数据卷的方式，将容器与内容绑定</li>
</ol>
<p>数据卷就是容器访问外部数据的通道，实现数据的部分共享</p>
<h4 id="绑定方式"><a class="markdownIt-Anchor" href="#绑定方式"></a> 绑定方式</h4>
<ol>
<li>
<p>匿名绑定</p>
<ul>
<li>启动容器时直接使用<code>-v container_dir</code>绑定</li>
<li>在<code>Docker</code>的<code>volumes</code>目录下生成一个随机目录，指定的<code>/container_dir</code>中的文件或目录将保存在该随机目录中</li>
<li>匿名绑定的<code>volumes</code>在容器被删除时也会被删除</li>
<li>使用<code>docker inspect container_id</code>查看<code>Mounts.Source</code>内容查找数据卷在主机中的哪个位置</li>
</ul>
<blockquote>
<p><code>container_dir</code>指的是容器内的目录</p>
</blockquote>
<p><img src="Docker%E6%B7%BB%E5%8A%A0%E5%8C%BF%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7.png" alt="Docker添加匿名数据卷" /></p>
<p><img src="Docker%E5%8C%BF%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BF%A1%E6%81%AF.png" alt="Docker匿名数据卷信息" /></p>
</li>
<li>
<p>具名绑定</p>
<ul>
<li>启动容器时直接使用<code>-v host_dir_name:container_dir</code>绑定</li>
<li>在<code>Docker</code>的<code>volumes</code>目录下生成一个<code>host_dir_name</code>目录，指定的<code>/container_dir</code>中的文件或目录将保存在该<code>host_dir_name</code>目录中</li>
<li>具名绑定的<code>volumes</code>在容器被删除时不会被删除</li>
<li>使用<code>docker inspect container_id</code>查看<code>Mounts.Source</code>内容查找数据卷在主机中的哪个位置</li>
</ul>
<p><img src="Docker%E6%B7%BB%E5%8A%A0%E5%85%B7%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7.png" alt="Docker添加具名数据卷" /></p>
<p><img src="Docker%E5%85%B7%E5%90%8D%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BF%A1%E6%81%AF.png" alt="Docker具名数据卷信息" /></p>
</li>
<li>
<p><code>Bind Mounts</code></p>
<ul>
<li><code>Bind Mounts</code>方式是绑定并加载主机的某个文件目录到容器中，而不是像前两种方式共享容器中的目录内容</li>
<li><code>Bind Mounts</code>绑定方式与具名绑定类似，不同的是具名绑定使用的是目录名称(自定义的)，<code>Bind Mounts</code>使用的是目录的绝对路径<code>-v /host_dir:container_dir</code></li>
</ul>
<p><img src="Docker%E6%B7%BB%E5%8A%A0Bind-Mounts%E6%95%B0%E6%8D%AE%E5%8D%B7.png" alt="Docker添加Bind-Mounts数据卷" /></p>
<p><img src="Docker-Bind-Mounts%E6%95%B0%E6%8D%AE%E5%8D%B7%E4%BF%A1%E6%81%AF.png" alt="Docker-Bind-Mounts数据卷信息" /></p>
</li>
</ol>
<h4 id="数据卷管理"><a class="markdownIt-Anchor" href="#数据卷管理"></a> 数据卷管理</h4>
<p><code>docker volume</code>命令管理数据卷</p>
<h5 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create</span><br></pre></td></tr></table></figure>
<h5 id="查看"><a class="markdownIt-Anchor" href="#查看"></a> 查看</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">ls</span>	<span class="comment"># 列表查看	</span></span><br><span class="line">docker volume inspect xxx <span class="comment"># 查看某个数据卷的详细信息</span></span><br></pre></td></tr></table></figure>
<h5 id="删除"><a class="markdownIt-Anchor" href="#删除"></a> 删除</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">rm</span> xxx <span class="comment"># 删除指定的数据卷</span></span><br><span class="line">docker volume prune <span class="comment"># 删除本地未使用的数据卷</span></span><br></pre></td></tr></table></figure>
<h3 id="网络"><a class="markdownIt-Anchor" href="#网络"></a> 网络</h3>
<p><code>Network</code></p>
<p>实现部分容器间的网络共享，管理多个子网下的容器<code>IP</code></p>
<h4 id="网络模式"><a class="markdownIt-Anchor" href="#网络模式"></a> 网络模式</h4>
<h5 id="桥接模式"><a class="markdownIt-Anchor" href="#桥接模式"></a> 桥接模式</h5>
<p><code>bridge</code>，在主机中创建一个<code>Docker</code>网桥(<code>Docker0</code>)，在<code>Docker0</code>上创建一对虚拟网卡一半在主机(<code>veth n</code>)，一半在容器内(<code>eth 0</code>)，是容器的默认网络模式</p>
<p><img src="Docker%E7%BD%91%E7%BB%9C%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F.png" alt="Docker网络桥接模式" /></p>
<h5 id="主机模式"><a class="markdownIt-Anchor" href="#主机模式"></a> 主机模式</h5>
<p><code>host</code>，容器不再有自己的网络空间，而是直接与主机共享网络空间，基于此模式创建的容器的<code>IP</code>实际就是与主机同一个子网</p>
<h5 id="none"><a class="markdownIt-Anchor" href="#none"></a> <code>none</code></h5>
<p><code>Docker</code>会有自己的网络空间，不与主机共享，在这个网络模式下的容器不会被分配网卡，<code>IP</code>，路由等相关信息</p>
<h5 id="container"><a class="markdownIt-Anchor" href="#container"></a> <code>container</code></h5>
<p><code>container</code>是基于已有容器的网络模式，与某个已有容器共享网络</p>
<h5 id="自定义"><a class="markdownIt-Anchor" href="#自定义"></a> 自定义</h5>
<p>使用<code>docker network</code>命令，基于前三种网络模式自定义网络模式</p>
<ol>
<li>
<p>创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create [opetion] &#123;name&#125;</span><br></pre></td></tr></table></figure>
<p><img src="Docker%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F.png" alt="Docker创建网络模式" /></p>
<p>使用自定义的网络创建容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --<span class="built_in">rm</span> -p &#123;host_port&#125;:&#123;container_port&#125; --name &#123;contrainer_name&#125; --net &#123;custom_network_name&#125; &#123;image_name&#125;</span><br></pre></td></tr></table></figure>
<p><img src="Docker%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%E8%BF%90%E8%A1%8C.png" alt="Docker基于自定义网络模式运行" /></p>
<p>网络内部的容器可以通过容器名称互通</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping &#123;contrainer_name&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">rm</span> xxx <span class="comment">#删除指定网络</span></span><br><span class="line">docker network prune <span class="comment">#删除所有未使用的网络</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将某个容器连接到某个网路欧中</span></span><br><span class="line">docker network connect &#123;network&#125; &#123;container&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>断开连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect &#123;network&#125; &#123;container&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span> <span class="comment"># 列表查看</span></span><br><span class="line">docker network inspect xxx <span class="comment"># 查看某个网络的详细信息</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="dockerfile"><a class="markdownIt-Anchor" href="#dockerfile"></a> <code>Dockerfile</code></h3>
<p>自定义构建镜像的配置文件，描述如何构建一个镜像，利用<code>Docker</code>的<code>build</code>命令，指定<code>Dockerfile</code>，就可以按照配置将镜像构建出来</p>
<h4 id="常用指令"><a class="markdownIt-Anchor" href="#常用指令"></a> 常用指令</h4>
<h5 id="from"><a class="markdownIt-Anchor" href="#from"></a> <code>FROM</code></h5>
<p>指定当前镜像的基础镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &#123;image_name&#125;</span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">21</span></span><br></pre></td></tr></table></figure>
<h5 id="maintainer"><a class="markdownIt-Anchor" href="#maintainer"></a> <code>MAINTAINER</code></h5>
<p>描述镜像的作者和联系方式（可选）</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">MAINTAINER</span> &#123;author_name&#125;&lt;&#123;author_address&#125;&gt;</span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> xiaolin&lt;xiao_lin_unit@<span class="number">163</span>.com&gt;</span><br></pre></td></tr></table></figure>
<h5 id="label"><a class="markdownIt-Anchor" href="#label"></a> <code>LABEL</code></h5>
<p>为镜像设置标签，可以设置多个（可选）</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> &#123;key&#125;=&#123;value&#125;</span></span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&#x27;1.0.0&#x27;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> description=<span class="string">&#x27;image description&#x27;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="env"><a class="markdownIt-Anchor" href="#env"></a> <code>ENV</code></h5>
<p>环境变量配置，可以设置多个</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &#123;key&#125; &#123;value&#125; <span class="comment"># 设置一个</span></span><br><span class="line"><span class="keyword">ENV</span> &#123;key&#125;=&#123;value&#125; &#123;key&#125;=&#123;value&#125;... <span class="comment">#设置多个</span></span><br></pre></td></tr></table></figure>
<h5 id="run"><a class="markdownIt-Anchor" href="#run"></a> <code>RUN</code></h5>
<p>在构建镜像时，需要执行的<code>shell</code>命令，长配合<code>ADD</code>使用</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> &#123;cmd&#125; <span class="comment"># 基于shell命令，执行某个命令</span></span></span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ls</span> -al</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /example</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;&#123;path&#125;/&#123;name&#125;.sh&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>...] <span class="comment"># 基于可执行文件</span></span></span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;/var/lib/rancher/k3s/etc/containerd/k3s-agent-uninstall.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<h5 id="add或者copy"><a class="markdownIt-Anchor" href="#add或者copy"></a> <code>ADD</code>或者<code>COPY</code></h5>
<p>将主机中的指定文件复制到容器中的目标位置</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> &#123;host_file&#125; &#123;container_dir&#125;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> [<span class="string">&quot;&#123;host_file&#125;&quot;</span>, <span class="string">&quot;&#123;container_dir&#125;&quot;</span>]</span></span><br><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> /etc/hosts /etc</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ADD和COPY的使用方式基本一致，大多数情况下可以替换</p>
<p>在添加压缩包时不能替换，ADD会将压缩包解压，但是COPY只是原样复制</p>
</blockquote>
<h5 id="workdir"><a class="markdownIt-Anchor" href="#workdir"></a> <code>WORKDIR</code></h5>
<p>设置容器中的工作目录，如果目录不存在，则创建</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> &#123;list_path&#125;</span></span><br><span class="line"><span class="comment"># 执行完后，后续操作将在该目录下执行（类似于cd到该目录下）</span></span><br></pre></td></tr></table></figure>
<h5 id="volume"><a class="markdownIt-Anchor" href="#volume"></a> <code>VOLUME</code></h5>
<p>镜像数据卷绑定，将主机中的指定目录挂在到容器中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;&#123;host_dir_path&#125;&quot;</span>]</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> &#123;host_dir_path&#125;</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> &#123;host_dir_path&#125; &#123;host_dir_path&#125;</span></span><br><span class="line"><span class="comment"># 通过这种方式绑定的目录，在主机目录和由该镜像创建的容器中的目录是一一对应的</span></span><br><span class="line"><span class="comment"># 如 主机中有一个 /www/xiaolin 目录，经过 VOLUME [&quot;/www/xiaolin&quot;] 绑定后，创建的容器用也有一个 /www/xiaolin 目录，而且与主机目录是Bind Mounts的绑定方式</span></span><br></pre></td></tr></table></figure>
<h5 id="expose"><a class="markdownIt-Anchor" href="#expose"></a> <code>EXPOSE</code></h5>
<p>设置容器启动后要对容器外暴露的端口</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> port</span><br><span class="line"><span class="comment"># 仅仅是指将容器的端口暴露出来，并不与主机建立绑定关系</span></span><br></pre></td></tr></table></figure>
<h5 id="cmd或者entrypoint"><a class="markdownIt-Anchor" href="#cmd或者entrypoint"></a> <code>CMD</code>或者<code>ENTRYPOINT</code></h5>
<p>选择其中一个即可，作用是描述镜像构建完成后，启动容器时默认执行的脚本或参数。只设置一次，如果写了多次则只有最后一次生效</p>
<ol>
<li>
<p><code>CMD</code>:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;&#123;path&#125;/&#123;bash&#125;.sh&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> &#123;cmd&#125; &#123;param1&#125; &#123;param2&#125;</span></span><br><span class="line"><span class="comment"># 会被容器运行时指定的命令覆盖</span></span><br><span class="line"><span class="comment"># docker run xxx /bin/bash -&gt; 其中/bin/bash会覆盖掉CMD执行的内容 </span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>ENTRYPOINT</code>:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;&#123;path&#125;/&#123;bash&#125;.sh&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> &#123;cmd&#125; &#123;param1&#125; &#123;param2&#125;</span></span><br><span class="line"><span class="comment"># 不会被容器运行时指定的命令覆盖</span></span><br><span class="line"><span class="comment"># docker run xxx /bin/bash -&gt; /bin/bash不会覆盖掉ENTRYPOINT执行的内容 </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>CMD的扩展性比ENTRYPOINT更高</p>
</blockquote>
<h5 id="扩展指令"><a class="markdownIt-Anchor" href="#扩展指令"></a> 扩展指令</h5>
<ol>
<li>
<p><code>ARG</code>: 设置变量，在镜像中定义一个变量，当使用<code>docker build</code>命令构建镜像时，带上<code>--build-arg key=value</code>来指定参数值</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &#123;var&#125;[=<span class="string">&quot;&#123;default_value&#125;&quot;</span>]</span><br><span class="line"><span class="comment"># 使用时用 $&#123;var&#125; 使用</span></span><br><span class="line"><span class="comment"># 如</span></span><br><span class="line"><span class="keyword">ARG</span> centos=latest</span><br><span class="line"><span class="keyword">FROM</span> centos:$contos</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>USER</code>: 设置容器的用户，可以是用户名或<code>PID</code>，如果容器设置了以<code>daemon</code>用户去运行，那么<code>RUN</code>、<code>CMD</code>和<code>ENTRYPOINT</code>都会以这个用户去运行，一定要先确定容器中有这个用户，并且有对应的操作权限</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> &#123;username&#125;</span><br><span class="line"><span class="keyword">USER</span> &#123;PID&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>ONBUILD</code>: 对构建当前镜像没有影响，在其他镜像的基础镜像为当前镜像时，会执行<code>ONBUILD</code>指定的操作</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ls</span> -al <span class="comment"># 如此镜像为 image01</span></span></span><br><span class="line"><span class="comment"># 上述内容在构建当前镜像时没有影响</span></span><br><span class="line"><span class="comment"># 当构建其他镜像，其基础镜像为当前镜像时（FROM image01），会执行RUN ls -al操作</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>STOPSIGNAL</code>: 容器停止时发送的信号</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">STOPSIGNAL</span> &#123;signal&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>HEALTHCHECK</code>: 在容器内部按照指定周期运行指定命令来检测容器健康状况；取消在基础镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> [opetion] CMD &#123;cmd&#125;</span></span><br><span class="line"><span class="comment"># option</span></span><br><span class="line"><span class="comment"># interval</span></span><br><span class="line"><span class="comment"># timeout</span></span><br><span class="line"><span class="comment"># retries</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="构建镜像"><a class="markdownIt-Anchor" href="#构建镜像"></a> 构建镜像</h4>
<h5 id="commit"><a class="markdownIt-Anchor" href="#commit"></a> <code>commit</code></h5>
<p>基于一个现有的容器，构建一个新的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit [option] &#123;container&#125; [repository[:tag]</span><br><span class="line">docker commit -a <span class="string">&quot;xiao-lin&quot;</span> -m <span class="string">&quot;build a image with a container&quot;</span> &#123;container_name&#125; &#123;image_name:version&#125;</span><br></pre></td></tr></table></figure>
<h5 id="build"><a class="markdownIt-Anchor" href="#build"></a> <code>build</code></h5>
<ol>
<li>
<p><code>spring-boot</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build 命令</span></span><br><span class="line">docker build [option] &#123;path&#125;</span><br><span class="line"><span class="comment"># path指向含有Dockerfile文件的目录</span></span><br><span class="line"><span class="comment"># option</span></span><br><span class="line"><span class="comment"># -t 指定tag</span></span><br><span class="line">docker build -t spring-boot-docker:1.0.0 .</span><br><span class="line"><span class="comment"># -t 指定镜像名称和版本</span></span><br><span class="line"><span class="comment"># path为 . ,即当前目录</span></span><br></pre></td></tr></table></figure>
<p><img src="Docker%E4%BD%BF%E7%94%A8Dockerfile%E6%9E%84%E5%BB%BASpringBoot%E9%95%9C%E5%83%8F.png" alt="Docker使用Dockerfile构建SpringBoot镜像" /></p>
</li>
<li>
<p><code>nginx</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> CENTOS_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> centos:$CENTOS_VERSION</span><br><span class="line"></span><br><span class="line"><span class="comment"># 维护者信息</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> xiaolin&lt;xiao_lin_unit@<span class="number">163</span>.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装工具</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum clean all</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum makecache</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y wget</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y gcc</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y gcc-c++</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y make</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y openssl-devel</span></span><br><span class="line"><span class="comment"># 创建 www用户作为nginx启动用户</span></span><br><span class="line"><span class="comment"># RUN useradd -s /sbin/nologin -M www</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/local/src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> wget http://nginx.org/download/nginx-1.22.1.tar.gz</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> tar -zxvf nginx-1.22.1.tar.gz</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/local/src/nginx-1.22.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx编译安装</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ./configure --prefix=/usr/local/nginx --with-http_ssl_module --with-http_stub_status_module</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭nginx后台运行</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;daemon off;&#x27;</span> &gt;&gt; /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 nginx 命令快速访问的环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> PATH=/usr/local/nginx/sbin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>]</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="仓库"><a class="markdownIt-Anchor" href="#仓库"></a> 仓库</h3>
<p><code>regitry</code></p>
<h4 id="阿里云"><a class="markdownIt-Anchor" href="#阿里云"></a> 阿里云</h4>
<ol>
<li>
<p>创建仓库：容器镜像服务 -&gt; 实例列表 -&gt; 个人/企业 -&gt; 命名空间（创建命名空间）-&gt; 镜像仓库（创建镜像仓库，自己使用的仓库选择本地仓库即可）</p>
<blockquote>
<p>创建的每一个仓库都是一个镜像的版本库，不同名称的镜像创建不同名称的仓库</p>
<p>如，你的<code>nginx</code>镜像就创建<code>nginx</code>仓库，你的<code>redis</code>镜像就创建<code>redis</code>仓库</p>
</blockquote>
</li>
<li>
<p>登录仓库：根据仓库的基本信息中的仓库登录方式，登录仓库并输入密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login --username=&#123;usernmae&#125; &#123;registy_sign&#125;.cn-qingdao.personal.cr.aliyuncs.com</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>推送仓库：分为打标签和推送两步</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打标签</span></span><br><span class="line">docker tag &#123;image_id&#125; &#123;registy_sign&#125;.cn-qingdao.personal.cr.aliyuncs.com/xiao_lin_unit/nginx:&#123;version&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推送，push的内容与前面打标签的内容要一致</span></span><br><span class="line">docker push &#123;registy_sign&#125;.cn-qingdao.personal.cr.aliyuncs.com/xiao_lin_unit/nginx:&#123;version&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="nexus"><a class="markdownIt-Anchor" href="#nexus"></a> <code>Nexus</code></h4>
<ol>
<li>
<p>主机做仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装jdk8</span></span><br><span class="line"><span class="built_in">sudo</span> apt install openjdk-8-jdk</span><br><span class="line"><span class="comment"># 2. 上传nexus包</span></span><br><span class="line"><span class="comment"># 3. 解压缩nexus包</span></span><br><span class="line">tar -zxvf nexus.tar.gz</span><br><span class="line"><span class="comment"># 修改相关配置后启动</span></span><br><span class="line">java -jar nexus.jar</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用<code>docker</code>镜像创建容器，绑定相关端口和数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/nexus</span><br><span class="line"><span class="built_in">chmod</span> 755 /opt/nexus</span><br><span class="line">docker run -d --restart=always -p 8868:8081 -p 5000:5000 -p 5001:5001 --name nexus -v /opt/nexus:/nexus-data sonatype/nexus3</span><br><span class="line"><span class="comment"># 我使用时镜像创建的容器内启动jar包时报错，无妨访问</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">3. 登录`nexus manager`，注意访问地址和端口</span><br><span class="line"></span><br><span class="line">4. 创建一个存储器`Blob Stores`</span><br><span class="line"></span><br><span class="line">5. 创建仓库`Repositories`选择`docker`类型的仓库，添加信息并创建</span><br><span class="line"></span><br><span class="line">6. 将私服仓库添加到`docker`的镜像源</span><br><span class="line"></span><br><span class="line">   ```bash</span><br><span class="line">   vi /etc/docker/daemon.json</span><br><span class="line">   </span><br><span class="line">   # 修改内容</span><br><span class="line">   &#123;</span><br><span class="line">     &quot;insecure-registries&quot;: [&quot;ip:5000&quot;, &quot;ip:5001&quot;]</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   systemctl daemon-reload</span><br><span class="line">   systemctl restart docker</span><br><span class="line">   # 使用docker方式部署nexus则需要重新启动容器</span><br></pre></td></tr></table></figure>
<h4 id="harbor"><a class="markdownIt-Anchor" href="#harbor"></a> <code>Harbor</code></h4>
<p><code>docker</code>专用，必须安装<code>docker</code>和<code>docker-compose</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y docker-compose</span><br></pre></td></tr></table></figure>
<p>下载<code>Harbor</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.11.1/harbor-offline-installer-v2.11.1.tgz</span><br><span class="line">tar -zxvf harbor-offline-installer-v2.11.1.tgz</span><br><span class="line"><span class="built_in">cd</span> harbor</span><br><span class="line"><span class="built_in">cp</span> harbor.yml.tmpl harbor.yml</span><br><span class="line">vi harbor.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">hostname: IP <span class="comment"># 不要用localhost和127.0.0.1</span></span><br><span class="line"><span class="comment"># 修改密码</span></span><br><span class="line">harbor_admin_password: 123456</span><br><span class="line"><span class="comment"># 注释掉ssl部分</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改完后安装</span></span><br><span class="line">bash prepare</span><br><span class="line">bash install.sh --with-trivy</span><br></pre></td></tr></table></figure>
<p>登录系统 -&gt; 创建项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;ip:port&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># 使用docker方式部署nexus则需要重新启动容器</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line">docker login -u&#123;username&#125; ip:port</span><br><span class="line"></span><br><span class="line">docker tag &#123;image_id&#125; ip:port/&#123;project_name&#125;/&#123;image_name&#125;[:&#123;version&#125;]</span><br><span class="line"></span><br><span class="line">docker push ip:port/&#123;project_name&#125;/&#123;image_name&#125;[:&#123;version&#125;]</span><br></pre></td></tr></table></figure>
<h3 id="容器编排"><a class="markdownIt-Anchor" href="#容器编排"></a> 容器编排</h3>
<p>针对容器生命周期的管理</p>
<p>依赖管理，副本数控制，配置共享</p>
<h4 id="docker-compose"><a class="markdownIt-Anchor" href="#docker-compose"></a> <code>Docker Compose</code></h4>
<p>单机环境的容器编排</p>
<p>关键：<code>docker-compose.yml</code>配置文件</p>
<h5 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 版本要跟docker对应</span></span><br><span class="line"><span class="comment"># 下载</span></span><br><span class="line"><span class="built_in">sudo</span> curl -L <span class="string">&quot;http://mirrors.aliyun.com/docker-toolbox/linux/1.21.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋予可执行权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加软链接</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>
<h5 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用</h5>
<p>创建一个目录作为一个项目的<code>docker-compose</code>工作空间，并在该目录下创建<code>docker-compose.yml</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -r /opt/docker/nginx</span><br><span class="line"><span class="built_in">cd</span> /opt/docker/nginx</span><br><span class="line"><span class="built_in">touch</span> docker-compose.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对普通镜像而言，最重要的三个配置是 services，networks，volumes</span></span><br><span class="line">vi docker-compose.yml</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>docker-compose.yml</code>的配置可以通过<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/compose-file">官方文档</a>查看</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.1&quot;</span> <span class="comment"># 遵循的docker-compose的api版本</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line">  <span class="comment"># mynginx配置</span></span><br><span class="line">  <span class="attr">mynginx:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;nginx&quot;</span> <span class="comment"># 指定镜像</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;always&quot;</span> <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">xiao_lin_n</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">xiao_lin_v:/var/lib/data</span></span><br><span class="line">    <span class="attr">envrionment:</span> </span><br><span class="line">      <span class="attr">APP_ENV:</span> <span class="string">dev</span></span><br><span class="line">    <span class="attr">dns:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span></span><br><span class="line">    <span class="attr">depends_on:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">centos</span> <span class="comment"># 依赖于centos服务，等centos服务启动才能运行</span></span><br><span class="line">  <span class="attr">centos:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">centos</span></span><br><span class="line">  <span class="attr">myservice:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;java&quot;</span></span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">xiao_lin_n</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">xiao_lin_v:/etc/data</span></span><br><span class="line">    <span class="attr">depends_on:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span> <span class="comment"># 表示容器暴露的端口，与主机不进行固定绑定</span></span><br><span class="line">  <span class="attr">redis:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;mysql:8.1&quot;</span></span><br><span class="line">      </span><br><span class="line"><span class="attr">networks:</span> </span><br><span class="line">  <span class="attr">xiao_lin_n:</span> </span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">ipam:</span> </span><br><span class="line">      <span class="attr">driver:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">config:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet0:</span> <span class="number">192.173</span><span class="number">.0</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">          <span class="attr">gateway:</span> <span class="number">192.173</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet1:</span> <span class="number">192.174</span><span class="number">.00</span><span class="string">/24</span></span><br><span class="line">          <span class="attr">gateway:</span> <span class="number">192.174</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> </span><br><span class="line">  <span class="attr">xiao_lin_v:</span> <span class="comment"># 通过数据卷定义，将上述两个服务的 /var/lib/data 和 /etc/data 目录挂载</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker-compose config <span class="comment"># 查看配置文件是否有错误</span></span><br><span class="line"><span class="comment"># 创建服务</span></span><br><span class="line">docker-compose create [&#123;service_name&#125;]</span><br><span class="line"><span class="comment"># 创建并启动服务</span></span><br><span class="line">docker-compose up [-d &#123;service_name&#125;]</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">docker-compose start [&#123;service_name&#125;]</span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">docker-compose stop</span><br><span class="line"><span class="comment"># 停止并删除服务</span></span><br><span class="line">docker-compose <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 弹性扩容缩容</span></span><br><span class="line">docker-compose scale &#123;service_name&#125;=num</span><br></pre></td></tr></table></figure>
<h4 id="swarm"><a class="markdownIt-Anchor" href="#swarm"></a> <code>Swarm</code></h4>
<p>分布式环境的容器编排</p>
<p>多台物理机，在<code>master</code>物理机上执行初始化命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init</span><br></pre></td></tr></table></figure>
<p><img src="Docker%E4%BD%BF%E7%94%A8Swarm%E5%88%9D%E5%A7%8B%E5%8C%96.png" alt="" /></p>
<p>在<code>node</code>物理机上执行上述红色标记的命令，将该物理机作为一个<code>node</code></p>
<p>之后的相关内容在<code>master</code>节点上执行即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建服务容器</span></span><br><span class="line"><span class="comment"># option</span></span><br><span class="line"><span class="comment"># replicas: 创建数量</span></span><br><span class="line">docker service create [option] &#123;image&#125;</span><br><span class="line">docker service create --replicas 1 -p 8080:80 --name nginx_swarm nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务信息</span></span><br><span class="line">docker service inspect --pretty &#123;service_name&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数量</span></span><br><span class="line">docker service update --replicas &#123;num&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># node节点退出集群</span></span><br><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure>
<h3 id="可视化"><a class="markdownIt-Anchor" href="#可视化"></a> 可视化</h3>
<p><code>portainer</code></p>
<p>使用<code>portainer</code>镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于swarm</span></span><br><span class="line">docker service create --replicas 1 -p 9000:9000 --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,src=/var/run/docker.sock,dst=/var/run/docker.sock --mount <span class="built_in">type</span>=volume,src=portainer_data,dst=/data portainer/portainer</span><br></pre></td></tr></table></figure>
<p>使用浏览器访问，初次访问时默认为<code>admin</code>用户，为其设置密码</p>
<ol>
<li>
<p>创建环境</p>
</li>
<li>
<p>基于环境进行<code>docker</code>管理</p>
<p><img src="Docker%E7%8E%AF%E5%A2%83%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AE%A1%E7%90%86.png" alt="Docker环境可视化管理" /></p>
</li>
</ol>

    </article>
    
    <div class="read-nums">
      <!-- id 将作为查询条件 -->
      <span id="2025/08/07/docker/Docker系列二之进阶使用/" class="leancloud_visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">浏览量</em>
        <i class="leancloud-visitors-count"></i>
      </span>
    </div>
    <div class="comments-intro">
      <h2>评论区</h2>
      <p>欢迎你留下宝贵的意见，昵称输入QQ号会显示QQ头像哦~</p>
    </div>
    <div id="vcomments" class="vcomments"></div>
    
  </div>
  <div class="article-catelogue">
    <div class="article-catelogue--wrapper">
      <div class="catelogue catelogue-1">
        <h3>目录</h3>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.</span> <span class="toc-text"> 数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text"> 基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text"> 绑定方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text"> 数据卷管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 查看</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.</span> <span class="toc-text"> 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text"> 网络模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 桥接模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text"> 主机模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#none"><span class="toc-number">2.1.3.</span> <span class="toc-text"> none</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#container"><span class="toc-number">2.1.4.</span> <span class="toc-text"> container</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.5.</span> <span class="toc-text"> 自定义</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile"><span class="toc-number">3.</span> <span class="toc-text"> Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text"> 常用指令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#from"><span class="toc-number">3.1.1.</span> <span class="toc-text"> FROM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#maintainer"><span class="toc-number">3.1.2.</span> <span class="toc-text"> MAINTAINER</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#label"><span class="toc-number">3.1.3.</span> <span class="toc-text"> LABEL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#env"><span class="toc-number">3.1.4.</span> <span class="toc-text"> ENV</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#run"><span class="toc-number">3.1.5.</span> <span class="toc-text"> RUN</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#add%E6%88%96%E8%80%85copy"><span class="toc-number">3.1.6.</span> <span class="toc-text"> ADD或者COPY</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#workdir"><span class="toc-number">3.1.7.</span> <span class="toc-text"> WORKDIR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#volume"><span class="toc-number">3.1.8.</span> <span class="toc-text"> VOLUME</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#expose"><span class="toc-number">3.1.9.</span> <span class="toc-text"> EXPOSE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cmd%E6%88%96%E8%80%85entrypoint"><span class="toc-number">3.1.10.</span> <span class="toc-text"> CMD或者ENTRYPOINT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%8C%87%E4%BB%A4"><span class="toc-number">3.1.11.</span> <span class="toc-text"> 扩展指令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">3.2.</span> <span class="toc-text"> 构建镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#commit"><span class="toc-number">3.2.1.</span> <span class="toc-text"> commit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#build"><span class="toc-number">3.2.2.</span> <span class="toc-text"> build</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%93%E5%BA%93"><span class="toc-number">4.</span> <span class="toc-text"> 仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">4.1.</span> <span class="toc-text"> 阿里云</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nexus"><span class="toc-number">4.2.</span> <span class="toc-text"> Nexus</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#harbor"><span class="toc-number">4.3.</span> <span class="toc-text"> Harbor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">5.</span> <span class="toc-text"> 容器编排</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-compose"><span class="toc-number">5.1.</span> <span class="toc-text"> Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 使用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#swarm"><span class="toc-number">5.2.</span> <span class="toc-text"> Swarm</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text"> 可视化</span></a></li></ol>
      </div>
      
        <div class="catelogue catelogue-2">
          
            <p>
              <span>上一篇：</span>
              <a href="/2025/08/11/docker/Docker系列三之项目部署/">Docker系列(三)---项目部署</a>
            </p>
           
          
            <p>
              <span>下一篇</span>
              <a href="/2025/08/05/docker/Docker系列一之安装和基本使用/">Docker系列(一)---安装和基本使用</a>
            </p>
          
        </div>
      
    </div>
  </div>
</div>


<script>
  // var定义，避免pjax重新进来造成的重复声明错误
  var config = JSON.parse('{"enable":true,"appId":"Pf8zCXGEH1qsprnWfikVVujL-gzGzoHsz","appKey":"qOqoiUHhH1TGtLRUYURkLRQX","placeholder":"请留下你宝贵的意见吧~","meta":["nick"],"recordIP":true,"visitor":true,"enableQQ":true}')
  new Valine({
    el: '#vcomments',
    appId: config.appId,
    appKey: config.appKey,
    placeholder: config.placeholder,
    meta: config.meta,
    recordIP: config.recordIP,
    visitor: config.visitor,
    enableQQ: config.enableQQ,
    path: '2025/08/07/docker/Docker系列二之进阶使用/'
  })
</script>


<script>
    const tocs = document.querySelector('.toc')
    const links = tocs ? tocs.querySelectorAll('a') : []
    links.forEach(link => {
      link.addEventListener('click', e => {
        let href = decodeURIComponent(link.href);
        href = href.substring(href.indexOf('#'));
        const target = $(href)[0];
        const top = target.offsetTop;
        document.documentElement.scrollTo({
          top: top - 100,
          behavior: 'smooth'
        })
        e.preventDefault()
      })
    })
</script> 

</div>
      <div class="main-right-wrapper"><div class="main-right">
  <div class="main-right--board">
    <div class="main-right--title">
      <h5>公告栏</h5>
      <i class="iconfont icon-gonggao"></i>
    </div>
    <div class="main-right--content">
      我们在绵延的海滩上捡贝壳，今天捡到了不必欣喜，因为海很大，今天没捡到，也不必失落，因为海很大。 
    </div>
  </div>

  <div id="aplayer" class="main-right--music"></div>

  <div class="operate-items">
    <div class="operate-item backtop">
      <i class="iconfont icon-huidaodingbu"></i>
      <span>回到顶部</span>
    </div>
    
    <div class="operate-item turn-comment hidden">
      <i class="iconfont icon-pinglun"></i>
      <span>查看评论</span>
    </div>
    
  </div>

  <div class="main-right--site">
    <div class="main-right--power">
      <p>Power By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a>.</p>
      <p>Theme：<a target="_blank" rel="noopener" href="https://github.com/Aizener/hexo-theme-cola">Cola.</a></p>
    </div>
    <p class="main-right--refer"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index">我好像没有网络备案</a> </p>
  </div>
</div>

<script>
  function setOperateItem () {
    const reg = /\d{4}\/\d{2}\/\d{2}\/.+/
    const path = location.pathname
    const operateDom = document.querySelector('.main-right .operate-items')
    const commentDom = document.querySelector('.turn-comment')
    const cateloguDom = document.querySelector('.article-catelogue > .article-catelogue--wrapper');

    if (commentDom) {
      if (reg.test(path) || path.match(/\/log\/.+/)) {
        commentDom.classList.remove('hidden')
        const newDom = operateDom.cloneNode(true);
        const _backtopDom = newDom.querySelector('.backtop');
        const _commentDom = newDom.querySelector('.turn-comment');
        _backtopDom.addEventListener('click', () => backTopEvent());
        _commentDom.addEventListener('click', () => commentDomEvent());
        cateloguDom.appendChild(newDom);
      } else {
        commentDom.classList.add('hidden')
      }
    }
  }

  setOperateItem()
  const musics = JSON.parse(`[{"name":"自転车","artist":"オレスカバンド","url":"/music/自転车-オレスカバンド.mp3","cover":"/imgs/music-bg1.jpg"},{"name":"撞地球","artist":"鱼儿七","url":"/music/撞地球-鱼儿七.mp3","cover":"/imgs/music-bg1.jpg"},{"name":"晴天","artist":"周杰伦","url":"/music/晴天-周杰伦.mp3","cover":"/imgs/music-bg1.jpg"},{"name":"告白气球","artist":"周杰伦","url":"/music/告白气球-周杰伦.mp3","cover":"/imgs/music-bg1.jpg"}]`)
  const ap = new APlayer({
    container: document.querySelector('#aplayer'),
    audio: musics,
  })

  $(document).on('pjax:complete', function() {
    setOperateItem()
  })

  document.querySelector('.backtop').addEventListener('click', () => {
    backTopEvent();
  })
  const dom = document.querySelector('.turn-comment')
  dom && dom.addEventListener('click', () => {
    commentDomEvent();
  })

  function backTopEvent() {
    document.documentElement.scrollTo({
      top: 0,
      behavior: 'smooth'
    })
  }

  function commentDomEvent() {
    const commentDom = document.querySelector('.comments-intro')
    if (!commentDom) return
    const top = commentDom.offsetTop, height = commentDom.offsetHeight
    document.documentElement.scrollTo({
      top: top - 2 * height,
      behavior: 'smooth'
    })
  }
</script></div>
    </section>
  </div>
  <div id="progress" class="progress"></div>
  <div id="gray" class="gray"></div>

  <script>
    function initScroll () {
      document.addEventListener('scroll', () => {
        const doc = document.documentElement
        const scrollTop = doc.scrollTop
        const pageHeight = doc.offsetHeight
        const clientHeight = doc.clientHeight
        const ratio = scrollTop / (pageHeight - clientHeight)
        const progress = document.querySelector('#progress')
        const avatarImg = document.querySelector('.main-left--avatar')
        progress.style.width = (100 * ratio) + '%'
        avatarImg.style.transform = `rotate(${360 * ratio}deg)`
      })
    }

    const rootPath = "/"

    const checkAndSetArticlePageLayout = () => {
      const path = location.pathname.replace(rootPath, '');
      if (
        /^\/?\d{4}\/\d{2}\/\d{2}\/.*/.test(path) ||
        /^log\/.+/.test(path)
      ) {
        $('.main-container, .main-right, .main-right-wrapper').addClass('is-article')
      } else {
        $('.main-container, .main-right, .main-right-wrapper').removeClass('is-article')
      }
    }

    const gray = "none"
    const setGrayStyle = () => {
      if (gray === 'none') {
        return
      } else if (gray === 'index') {
        location.pathname === '/' ? $('#gray').show() : $('#gray').hide()
      } else if (gray === 'all') {
        $('#gray').show()
      }
    }
    setGrayStyle()


    window.onload = function () {
      checkAndSetArticlePageLayout()
      setTimeout(() => {
        $('#load').slideUp()
        $('#container').slideToggle()
        setTimeout(() => {
          initScroll();
        }, 500)
      }, 500)
    }
    
    let status = 0
    // 对所有链接跳转事件绑定pjax容器container
    $(document).pjax('a[target!=_blank]', '#main-container', {
      container: '#main-container',
      fragment: '#main-container',
      timeout: 8000
    })

    $(document).on('pjax:start', function() {
    })
    $(document).on('pjax:complete', function() {
      status = 0
      $('.main-container').addClass('to-up').on('animationend', function() {
        $(this).removeClass('to-up')
      })
      setGrayStyle()
      checkAndSetArticlePageLayout()
    })
    $(document).on('pjax:popstate', function() {
      status = -1
      checkAndSetArticlePageLayout()
    });
  </script>
</body>
</html>